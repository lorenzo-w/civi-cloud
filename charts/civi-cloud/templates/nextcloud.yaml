apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: nextcloud
spec:
  interval: 5m
  chart:
    spec:
      chart: ./charts/nextcloud
      sourceRef:
        kind: GitRepository
        name: civi-cloud
        namespace: flux-system
  values:
    ssoConfig:
      secretName: {{ .Values.ssoConfig.secretName }}
      namespace: {{ .Values.ssoConfig.namespace }}
    oidcClient:
      id: civi-oidc
      secretName: civi-oidc-client
    smtp: {{ .Values.smtp | toYaml | nindent 6 }}
    org: {{ .Values.org | toYaml | nindent 6 }}
    hostname: {{ include "get_hostname" (dict "service" "nextcloud" "context" $) }}
